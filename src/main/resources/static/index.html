<!doctype html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>URL 단축기</title>
</head>
<body>
<h1>URL 단축기에 오신 것을 환영합니다.</h1>
<div style="display: flex; flex-direction: column; width: 300px;">
    <label for="url">URL:</label>
    <input type="text" id="url" required>
    <label for="alias">경로:</label>
    <input type="text" id="alias" placeholder="설정하지 않으면 랜덤으로 생성됩니다.">
    <label for="expire">만료 시간</label>
    <select id="expire">
        <option value="-1" selected>(만료 없음)</option>
        <option value="10">10초</option>
        <option value="60">1분</option>
        <option value="600">10분</option>
        <option value="3600">1시간</option>
        <option value="86400">1일</option>
        <option value="604800">1주일</option>
        <option value="2592000">1개월</option>
        <option value="31536000">1년</option>
    </select>
    <button type="button" style="margin-top: 1rem; margin-bottom: 1rem">단축 URL 생성하기</button>
    <div id="error" style="color: red;"></div>
    <div id="message"></div>
</div>
<script>
    document.querySelector('button').addEventListener('click', function () {
        const url = document.getElementById('url').value;
        const alias = document.getElementById('alias').value;
        const expire = document.getElementById('expire').value;
        const messageDiv = document.getElementById('message');
        const errorDiv = document.getElementById('error');

        messageDiv.textContent = ''
        errorDiv.textContent = '';

        if (!url) {
            messageDiv.textContent = 'URL을 입력하세요.';
            return;
        }

        const expiresAt = expire && parseInt(expire) > 0 ? new Date(Date.now() + parseInt(expire) * 1000).toISOString() : undefined;

        fetch('/api/create', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({url, alias, expiresAt})
        })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'error') {
                    throw data.message;
                }

                data = data.data

                if (data.alias) {
                    messageDiv.textContent = `단축 URL 생성에 성공했습니다: ${window.location.origin}/${data.alias}`;
                    if (data.expiresAt) {
                        messageDiv.textContent += ` 만료 시간: ${new Date(data.expiresAt).toLocaleString()}`;
                    }
                } else {
                    console.log(data)
                    alert("이 메시지를 본다면 웹사이트 버그입니다.");
                }
            })
            .catch(error => {
                console.error(error);
                errorDiv.textContent = '오류가 발생했습니다: ' + error;
            });
    });
</script>
</body>
</html>
